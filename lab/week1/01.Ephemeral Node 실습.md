## Ephemeral Node 실습

### 개념

- Ephemeral 노드는 생성한 클라이언트 세션이 종료되면 자동으로 삭제된다.
- 주로 서비스 등록, 리더 선출 등에 사용된다.

### 실습 절차

#### Step 1. CLI 접속

```bash

docker exec -it zookeeper zkCli.sh -server 127.0.0.1:2181
```

#### Step 2. 노드 생성

```bash

create -e /ephemeral "temp"
```

#### Step 3. 노드 존재 확인

```bash

ls /
```

결과에 `/ephemeral`이 포함되어 있어야 한다.

#### Step 4. 세션 종료

- `exit` 또는 `Ctrl + C` 입력
- 해당 세션이 종료됨

#### Step 5. CLI 재접속 후 확인

```bash

zkCli.sh -server 127.0.0.1:2181
ls /
```

→ `/ephemeral` 노드가 사라졌다면 정상 작동이다.

---

## 2. Ephemeral + Sequential Node 실습

### 개념

- Sequential 노드는 자동으로 숫자가 붙는 노드다.
- Ephemeral + Sequential 조합은 **임시적이며 순서가 있는 노드**를 만든다.
- 분산 락 구현, 큐잉 구조 구현 등에 사용된다.

### 실습 절차

#### Step 1. CLI 접속

```bash

docker exec -it zookeeper zkCli.sh -server 127.0.0.1:2181
```

#### Step 2. 노드 생성

```bash

create -e -s /lock- ""
create -e -s /lock- ""
create -e -s /lock- ""
```

#### Step 3. 확인

```bash
ls /
```

결과 예:

```
[lock-0000000000, lock-0000000001, lock-0000000002]
```

#### Step 4. 세션 종료 → 노드 자동 삭제 확인

- CLI 종료
- 다시 접속하여 `ls /` 확인
- 본인이 만든 `/lock-*` 노드가 삭제되어 있어야 한다

---

## 3. 내부 동작 정리

| 개념 | 설명 |
|------|------|
| `-e` | ephemeral: 세션 종료 시 자동 삭제 |
| `-s` | sequential: 자동으로 번호가 붙음 |
| `/lock-` | prefix 이름. 실제 생성되는 노드는 `/lock-000000000X` |
| 세션 | 하나의 CLI 접속 단위. ephemeral 노드는 세션에 종속된다 |

---

## 4. 응용 시나리오: 분산 락 큐잉

1. 모든 클라이언트가 `/lock-` 형태로 ephemeral + sequential 노드를 생성한다.
2. 가장 작은 번호를 가진 노드가 락을 획득한다.
3. 작업이 끝나면 해당 노드를 삭제한다.
4. 다음 순번 노드가 락을 획득한다.

---

## 5. 명령어 요약

```bash

# Zookeeper CLI 접속
docker exec -it zookeeper zkCli.sh -server 127.0.0.1:2181

# ephemeral 노드 생성
create -e /ephemeral "temp"

# ephemeral + sequential 노드 생성
create -e -s /lock- ""

# 노드 목록 확인
ls /

# CLI 종료
exit
```

---

## 6. 확인 포인트

- ephemeral 노드는 세션이 종료되면 삭제되어야 한다.
- sequential 노드는 자동으로 번호가 붙는다.
- ephemeral + sequential 조합은 분산 락 구현의 핵심 요소다.